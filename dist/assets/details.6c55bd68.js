import{_ as Z,d as ee,c as ue,b as ae,r as c,o as le,e as F,f as n,i as v,k as B,h as g,j as r,w as l,F as m,D as p,g as f,l as b,A,B as D,aa as te,M as q}from"./index.2854391f.js";import{n as re,g as oe,f as ne,a as de,u as se,o as ie,h as ce}from"./intelligence.5f29353a.js";import{D as ve,E as me,F as Fe,G as pe}from"./commonData.fd496339.js";const fe={class:"apply detail-base intelligenc"},ge={ref:"mainHeight",class:"bg-wt min-steph height"},be={class:"dialog-form"},Ae=ee({__name:"details",setup(Be){const k=ue(),C=ae(),h=c(null),u=c({alertEffectivePeriod:"00:00:00~23:59:59",status:1}),w=c([]),I=c(["00:00:00","23:59:59"]),N=c(null),E=c([]),y=c([]),V=c(),_=c({}),x=c({pageSize:100,currentPage:1}),O={productKey:[{required:!0,message:"\u6240\u5C5E\u4EA7\u54C1\u4E3A\u7A7A\uFF0C\u8BF7\u9009\u62E9\u6240\u5C5E\u4EA7\u54C1",type:"error",trigger:"change"}],moduleId:[{required:!0,message:"\u6A21\u5757\u4E3A\u7A7A\uFF0C\u8BF7\u9009\u62E9\u6A21\u5757",type:"error",trigger:"change"}],functionId:[{required:!0,message:"\u529F\u80FD\u540D\u79F0\u4E3A\u7A7A\uFF0C\u8BF7\u9009\u62E9\u529F\u80FD\u540D\u79F0",type:"error",trigger:"change"}],deviceId:[{required:!0,message:"\u5173\u8054\u8BBE\u5907\u4E3A\u7A7A\uFF0C\u8BF7\u9009\u62E9\u5173\u8054\u8BBE\u5907",type:"error",trigger:"change"}],alertRuleName:[{required:!0,message:"\u62A5\u8B66\u89C4\u5219\u540D\u79F0\u4E3A\u7A7A\uFF0C\u8BF7\u8F93\u5165\u62A5\u8B66\u89C4\u5219\u540D\u79F0",type:"error",trigger:"blur"}],operator:[{required:!0,message:"\u8FD0\u7B97\u7B26\u4E3A\u7A7A\uFF0C\u8BF7\u9009\u62E9\u8FD0\u7B97\u7B26",type:"error",trigger:"change"}],value:[{required:!0,message:"\u9608\u503C\u4E3A\u7A7A\uFF0C\u8BF7\u8F93\u5165\u9608\u503C",type:"error",trigger:"change"}],duration:[{required:!0,message:"\u6301\u7EED\u5468\u671F\u4E3A\u7A7A\uFF0C\u8BF7\u9009\u62E9\u6301\u7EED\u5468\u671F",type:"error",trigger:"change"}],dataAggregationPeriod:[{required:!0,message:"\u6570\u636E\u805A\u5408\u5468\u671F\u4E3A\u7A7A\uFF0C\u8BF7\u9009\u62E9\u6570\u636E\u805A\u5408\u5468\u671F",type:"error",trigger:"change"}],alertEffectivePeriod:[{required:!0,message:"\u62A5\u8B66\u751F\u6548\u65F6\u6BB5\u4E3A\u7A7A\uFF0C\u8BF7\u9009\u62E9\u62A5\u8B66\u751F\u6548\u65F6\u6BB5",type:"error",trigger:"change"}],alertSilentPeriod:[{required:!0,message:"\u62A5\u8B66\u6C89\u9ED8\u5468\u671F\u4E3A\u7A7A\uFF0C\u8BF7\u9009\u62E9\u62A5\u8B66\u6C89\u9ED8\u5468\u671F",type:"error",trigger:"change"}]};le(()=>{k.query.id&&(h.value=k.query.id,R()),j()});const R=async()=>{const t=await re(h.value);t.code===200&&(u.value=t.data,u.value.duration=String(u.value.duration),P(u.value.productKey),S(u.value.productKey))},U=()=>{N.value.validate().then(async t=>{if(t===!0){const a=u.value.alertSilentPeriod;typeof a=="number"?u.value.alertSilentPeriod=a:u.value.alertSilentPeriod=Number(te(a)),u.value={...u.value,alertSilentPeriod:u.value.alertSilentPeriod,dataAggregationPeriod:Number(u.value.dataAggregationPeriod),duration:Number(u.value.duration),value:Number(u.value.value)},h.value?(await se(u.value)).code===200&&(q.success("\u7F16\u8F91\u6210\u529F"),C.push({path:"/intelligence/rule"})):(await ie(u.value)).code===200&&(q.success("\u6DFB\u52A0\u6210\u529F"),C.push({path:"/intelligence/rule"}))}})},j=async()=>{const t=await oe(x.value);t.code===200&&(w.value=t.data.list.productInfo)},P=async t=>{const o=await ne({productKey:t});if(o.code===200&&o.data!==void 0){const s=JSON.parse(o.data.thingModelJson);y.value=[];const i={functionBlockId:"-1",functionBlockName:"\u9ED8\u8BA4\u6A21\u5757"};s.functionBlocks!==void 0&&(y.value=s.functionBlocks),E.value=s.properties,y.value.unshift(i)}},S=async t=>{const o=await de({pageSize:100,currentPage:1,productKey:t});if(o.data){V.value=o.data.records;const s={id:"-1",deviceId:"-1",deviceName:"\u5168\u90E8\u8BBE\u5907"};V.value.unshift(s)}},L=async()=>{_.value={..._.value,productKey:u.value.productKey};const t=await ce(_.value);if(t.code===200)if(t.data){const a=t.data.list.propertyStatusInfo;E.value=a}else E.value=[]},M=(t,a)=>{u.value.productName=a.selectedOptions[0].label,u.value.productKey=t,P(t),S(t),delete u.value.functionId},z=(t,a)=>{u.value.moduleName=a.selectedOptions[0].label,t!=="-1"?(_.value.functionBlockId=a.selectedOptions[0].value,L()):(delete _.value.functionBlockId,P(u.value.productKey))},H=(t,a)=>{u.value.functionName=a.selectedOptions[0].label},J=(t,a)=>{u.value.deviceName=a.selectedOptions[0].label},T=(t,a)=>{a.selectedOptions[0].key>4?u.value.remark=a.selectedOptions[0].value*60:u.value.remark=a.selectedOptions[0].value},$=t=>{u.value.alertEffectivePeriod=`${t[0]}~${t[1]}`},G=()=>{C.go(-1)};return(t,a)=>{const o=F("t-option"),s=F("t-select"),i=F("t-form-item"),Q=F("t-input"),W=F("t-input-number"),K=F("t-card"),X=F("t-time-range-picker"),Y=F("t-form");return n(),v(m,null,[B("div",fe,[g(" end "),B("div",ge,[B("div",be,[g(" \u57FA\u672C\u4FE1\u606F "),r(Y,{ref_key:"form",ref:N,data:u.value,rules:O,"label-width":108},{default:l(()=>[r(K,{title:"\u62A5\u8B66\u89C4\u5219"},{default:l(()=>[r(i,{label:"\u6240\u5C5E\u4EA7\u54C1\uFF1A",name:"productKey"},{default:l(()=>[r(s,{modelValue:u.value.productKey,"onUpdate:modelValue":a[0]||(a[0]=e=>u.value.productKey=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9",class:"wt-300",onChange:M},{default:l(()=>[(n(!0),v(m,null,p(w.value,(e,d)=>(n(),f(o,{key:d,value:e.productKey,label:e.productName,title:""},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(i,{label:"\u6A21\u5757\uFF1A",name:"moduleId"},{default:l(()=>[r(s,{modelValue:u.value.moduleId,"onUpdate:modelValue":a[1]||(a[1]=e=>u.value.moduleId=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9",class:"wt-300",disabled:u.value.productKey===void 0,onChange:z},{default:l(()=>[(n(!0),v(m,null,p(y.value,(e,d)=>(n(),f(o,{key:d,value:e.functionBlockId,label:e.functionBlockName,title:""},{default:l(()=>[b(A(e.functionBlockName),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),r(i,{label:"\u529F\u80FD\u540D\u79F0\uFF1A",name:"functionId"},{default:l(()=>[r(s,{modelValue:u.value.functionId,"onUpdate:modelValue":a[2]||(a[2]=e=>u.value.functionId=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9",class:"wt-300",disabled:u.value.moduleId===void 0,onChange:H},{default:l(()=>[(n(!0),v(m,null,p(E.value,(e,d)=>(n(),f(o,{key:d,value:e.identifier,label:e.name,title:""},{default:l(()=>[b(A(e.name),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),r(i,{label:"\u5173\u8054\u8BBE\u5907\uFF1A",name:"deviceId"},{default:l(()=>[r(s,{modelValue:u.value.deviceId,"onUpdate:modelValue":a[3]||(a[3]=e=>u.value.deviceId=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9",class:"wt-300",disabled:u.value.productKey===void 0,onChange:J},{default:l(()=>[(n(!0),v(m,null,p(V.value,(e,d)=>(n(),f(o,{key:d,value:e.deviceId,label:e.deviceName,title:""},{default:l(()=>[b(A(e.deviceName),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),r(i,{label:"\u62A5\u8B66\u89C4\u5219\u540D\u79F0\uFF1A",name:"alertRuleName"},{default:l(()=>[r(Q,{modelValue:u.value.alertRuleName,"onUpdate:modelValue":a[4]||(a[4]=e=>u.value.alertRuleName=e),placeholder:"\u8BF7\u8F93\u5165",class:"wt-300","show-limit-number":"",maxlength:20},null,8,["modelValue"])]),_:1}),g(" TODO \u6682\u65F6\u5E72\u6389"),g(` <t-form-item label="\u7EDF\u8BA1\u5B57\u6BB5\uFF1A" name="statisticField">\r
              <t-select\r
                v-model="formData.statisticField"\r
                clearable\r
                filterable\r
                placeholder="\u8BF7\u9009\u62E9"\r
                class="wt-300"\r
              >\r
                <t-option\r
                  v-for="(item, index) in statistFicalData"\r
                  :key="index"\r
                  :value="item.value"\r
                  :label="item.value"\r
                  title=""\r
                >\r
                  {{ item.value }}\r
                </t-option>\r
              </t-select>\r
            </t-form-item> `),r(i,{label:"\u8FD0\u7B97\u7B26\uFF1A",name:"operator"},{default:l(()=>[r(s,{modelValue:u.value.operator,"onUpdate:modelValue":a[5]||(a[5]=e=>u.value.operator=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9",class:"wt-300"},{default:l(()=>[(n(!0),v(m,null,p(D(ve),(e,d)=>(n(),f(o,{key:d,value:e.value,label:e.value,title:""},{default:l(()=>[b(A(e.value),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(i,{label:"\u9608\u503C\uFF1A",name:"value"},{default:l(()=>[r(W,{modelValue:u.value.value,"onUpdate:modelValue":a[6]||(a[6]=e=>u.value.value=e),step:1,placeholder:"0.0","decimal-places":1},null,8,["modelValue"])]),_:1}),r(i,{label:"\u6301\u7EED\u5468\u671F\uFF1A",name:"duration"},{default:l(()=>[r(s,{modelValue:u.value.duration,"onUpdate:modelValue":a[7]||(a[7]=e=>u.value.duration=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9",class:"wt-300"},{default:l(()=>[(n(!0),v(m,null,p(D(me),(e,d)=>(n(),f(o,{key:d,value:e.value,label:e.value,title:""},{default:l(()=>[b(A(e.value),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(i,{label:"\u6570\u636E\u805A\u5408\u5468\u671F\uFF1A",name:"dataAggregationPeriod"},{default:l(()=>[r(s,{modelValue:u.value.dataAggregationPeriod,"onUpdate:modelValue":a[8]||(a[8]=e=>u.value.dataAggregationPeriod=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9",class:"wt-300"},{default:l(()=>[(n(!0),v(m,null,p(D(Fe),(e,d)=>(n(),f(o,{key:d,value:e.value,label:e.value+"\u5206\u949F",title:""},{default:l(()=>[b(A(e.value)+" \u5206\u949F ",1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),g(" \u7533\u8BF7\u4FE1\u606F "),r(K,{title:"\u901A\u77E5\u65B9\u5F0F"},{default:l(()=>[r(i,{label:"\u62A5\u8B66\u751F\u6548\u65F6\u6BB5\uFF1A",name:"alertEffectivePeriod"},{default:l(()=>[r(X,{modelValue:I.value,"onUpdate:modelValue":a[9]||(a[9]=e=>I.value=e),class:"demos",clearable:"",format:"HH:mm:ss","allow-input":"",onPick:$},null,8,["modelValue"])]),_:1}),r(i,{label:"\u62A5\u8B66\u6C89\u9ED8\u5468\u671F\uFF1A",name:"alertSilentPeriod"},{default:l(()=>[r(s,{modelValue:u.value.alertSilentPeriod,"onUpdate:modelValue":a[10]||(a[10]=e=>u.value.alertSilentPeriod=e),clearable:"",filterable:"",placeholder:"\u8BF7\u9009\u62E9",class:"wt-300",onChange:T},{default:l(()=>[(n(!0),v(m,null,p(D(pe),(e,d)=>(n(),f(o,{key:d,value:e.value,label:e.id>=4?e.value+"\u5C0F\u65F6":e.value+"\u5206\u949F",title:""},{default:l(()=>[b(A(e.id>=4?e.value+"\u5C0F\u65F6":e.value+"\u5206\u949F"),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),g(" end ")]),_:1},8,["data"]),g(" end ")])],512)]),B("div",{class:"boxBottom fx fx-ct bg-wt"},[B("button",{class:"bt-grey wt-60",onClick:G},"\u8FD4\u56DE"),B("button",{class:"bt wt-60",theme:"primary",onClick:U},"\u63D0\u4EA4")])],64)}}});var De=Z(Ae,[["__scopeId","data-v-89f27296"],["__file","D:/project/2023/project-zhyl-admin-vue3-java/src/pages/intelligence/warn/details.vue"]]);export{De as default};
